<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PestigePages — Premium Books</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/homepage.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="site-header">
      <div class="container nav">
        <button
          class="icon-btn hamburger"
          id="navToggle"
          aria-label="Open menu"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M3 6h18M3 12h18M3 18h18"
              stroke="#5f5a54"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </button>
        <div class="brand">PrestigePages</div>
        <nav class="nav-links" aria-label="Main">
          <a href="homepage-logged.html">Home</a>
          <a href="#popular">Store</a>
          <a href="about-us-logged.html">About us</a>
        </nav>

        <div class="nav-spacer"></div>

        <div class="actions">
          <button class="icon-btn" aria-label="Wishlist">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12.1 20.3 4.7 13c-2.6-2.6-1.9-6.9 1.6-8.5 1.7-.8 3.7-.5 5.1.7 1.4-1.2 3.4-1.5 5.1-.7 3.5 1.6 4.2 5.9 1.6 8.5l-7.3 7.3Z"
                stroke="#7E6E5B"
                stroke-width="1.6"
                fill="#fff"
              />
            </svg>
          </button>

           <button id="cartBtn" class="icon-btn" aria-label="Cart">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M3 3h2l2.4 12.3a2 2 0 0 0 2 1.7h6.9a2 2 0 0 0 2-1.6L21 7H6"
                stroke="#7E6E5B"
                stroke-width="1.6"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <circle cx="10" cy="20" r="1.5" fill="#7E6E5B" />
              <circle cx="17" cy="20" r="1.5" fill="#7E6E5B" />
            </svg>
          </button>

          <div class="dropdown">
            <div class="dropdown-trigger">
              <button class="dropbtn" id="welcomeMessage">Loading....</button>
              <img
                src="images/down-arrow.png"
                alt="arrow"
                width="30"
                class="dropdown-arrow"
              />
            </div>
            <div class="dropdown-content">
              <a href="profile.html">Profile</a>
              <a href="#" id="logoutBtn">Logout</a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main>
      <!-- Hero -->
      <section class="hero">
        <div class="container hero-inner">
          <div class="hero-copy">
            <div class="eyebrow">New Arrivals</div>
            <h1>Experience our<br />New Exclusive Books</h1>
            <p>
              Discover hand‑picked titles from acclaimed authors. Enjoy quality
              hardbacks, digital editions, and secure shipping right to your
              door.
            </p>
            <div class="cta">
              <a href="#popular" class="btn">Shop Now</a>
              <a href="about-us-logged.html" class="btn secondary">Learn more</a>
            </div>
          </div>
          <div class="hero-art">
            <div class="stack">
              <img
                alt="Book stack"
                src="https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?q=80&w=700&auto=format&fit=crop"
              />
            </div>
            <div class="blob" aria-hidden="true"></div>
          </div>
        </div>
      </section>

      <!-- Feature bar -->
      <section class="features">
        <div class="container feature-row">
          <div class="feature">
            <div class="badge" aria-hidden>
              <svg
                width="22"
                height="22"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 2 3 6v6c0 5 3.8 9.7 9 10 5.2-.3 9-5 9-10V6l-9-4Z"
                  fill="#F6E8C8"
                  stroke="#C89B3C"
                />
                <path
                  d="m8.5 12 2.3 2.3 4.7-4.7"
                  fill="none"
                  stroke="#3F7A3B"
                  stroke-width="2"
                  stroke-linecap="round"
                />
              </svg>
            </div>
            <div>
              <h4>Certified</h4>
              <p>Authentic editions from the publisher</p>
            </div>
          </div>
          <div class="feature">
            <div class="badge" aria-hidden>
              <svg
                width="22"
                height="22"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <rect
                  x="3"
                  y="8"
                  width="18"
                  height="12"
                  rx="2"
                  fill="#F6E8C8"
                  stroke="#C89B3C"
                />
                <path
                  d="M7 8V6a5 5 0 0 1 10 0v2"
                  stroke="#7E6E5B"
                  stroke-width="2"
                  fill="none"
                />
              </svg>
            </div>
            <div>
              <h4>Secure</h4>
              <p>Encrypted checkout and privacy‑first</p>
            </div>
          </div>
          <div class="feature">
            <div class="badge" aria-hidden>
              <svg
                width="22"
                height="22"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M3 14h16l2 4H5l-2-4Z"
                  fill="#F6E8C8"
                  stroke="#C89B3C"
                />
                <path d="M7 14V9h12l2 5" fill="none" stroke="#7E6E5B" />
                <circle cx="8" cy="19" r="1.6" fill="#7E6E5B" />
                <circle cx="18" cy="19" r="1.6" fill="#7E6E5B" />
              </svg>
            </div>
            <div>
              <h4>Shipping</h4>
              <p>Fast, reliable worldwide delivery</p>
            </div>
          </div>
        </div>
      </section>

    <!-- Popular books -->
    
    
    <section id="popular" class="container">
      <div class="section-head">
        <h2>Our Popular Books</h2>
        <div class="search" role="search">
        <input id="searchInput" type="search" placeholder="Search books…" />
        <svg aria-hidden width="18" height="18" viewBox="0 0 24 24" fill="none">
          <circle cx="11" cy="11" r="7" stroke="#A89983" stroke-width="2" />
          <path d="m20 20-3.5-3.5" stroke="#A89983" stroke-width="2" stroke-linecap="round" />
        </svg>
      </div>
        <a class="see-all" href="#">See all</a>
      </div>

      <div style="display: flex; justify-content: space-between;">
      <aside class="sidebar" style="width: 25rem;" >
    <h3>Categories</h3>
    <label><input type="checkbox"> Limited</label><br>
    <label><input type="checkbox"> Collector's</label><br>
    <label><input type="checkbox"> Leather-Bound</labe><br>
    <label><input type="checkbox"> First Ed.</label><br>
    <label><input type="checkbox"> Signed</label><br>
    <label><input type="checkbox"> Art Books</label><br>
    <label><input type="checkbox"> Coffee Table</label><br>
    <label><input type="checkbox"> Antiquarian</label><br>
    <label><input type="checkbox"> Anniversary</label><br>
    <label><input type="checkbox"> Custom</label><br>

    </aside>
      <div id="book-grid" class="grid" aria-live="polite" style="margin-top: 1rem;"></div>
      </div>
    </section>
  </main>

    <footer style="border-color: #222222">
      <div class="container">
        <div style="display: flex; gap: 14px; align-items: center">
          <div class="brand">PrestigePages.com</div>
          <span>© <span id="yr"></span> • All rights reserved</span>
        </div>
      </div>
    </footer>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
      <div class="modal-content">
        <span id="closeProfile" class="close-btn">&times;</span>

        <h2>Your Profile</h2>

        <p>
          <strong>First Name:</strong>
          <span id="profileFirstName">Loading...</span>
        </p>
        <p>
          <strong>Last Name:</strong>
          <span id="profileLastName">Loading...</span>
        </p>
        <p><strong>Email:</strong> <span id="profileEmail">Loading...</span></p>
        <p>
          <strong>Address:</strong> <span id="profileAddress">Not set</span>
        </p>
        <p><strong>Mobile:</strong> <span id="profileMobile">Not set</span></p>

        <button id="editProfileBtn" class="btn">Edit Profile</button>
      </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" id="closeEdit">&times;</span>
        <h2>Edit Profile</h2>

        <form id="editProfileForm">
          <label>First Name</label>
          <input type="text" id="editFirstName" required />

          <label>Last Name</label>
          <input type="text" id="editLastName" required />

          <label>Address</label>
          <input type="text" id="editAddress" />

          <label>Mobile Number</label>
          <input type="text" id="editMobile" />

          <button type="submit" class="btn">Save Changes</button>
        </form>
      </div>
    </div>

    <!-- Wishlist Modal -->
    <div id="wishlistModal" class="modal">
      <div class="modal-content">
        <span id="closeWishlist" class="close-btn">&times;</span>
        <h2>Your Wishlist</h2>
        <div id="wishlistItems"></div>
      </div>
    </div>

    <script type="module">
  // --- Firebase Imports ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    signOut,
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import {
    getFirestore,
    doc,
    getDoc,
    updateDoc,
    arrayUnion,
    arrayRemove,
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // --- Firebase Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyCC_14beDBhudrtoAIFqc29TCMY5zoa4AA",
    authDomain: "prestige-pages.firebaseapp.com",
    databaseURL: "https://prestige-pages-default-rtdb.firebaseio.com",
    projectId: "prestige-pages",
    storageBucket: "prestige-pages.appspot.com",
    messagingSenderId: "1065922943021",
    appId: "1:1065922943021:web:e5829dd09e206063b500a4",
    measurementId: "G-V0E6PXN1Z5",
  };

  // --- Init Firebase ---
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // --- Elements ---
  const welcomeEl = document.getElementById("welcomeMessage");
  const logoutBtn = document.getElementById("logoutBtn");
  const wishlistBtn = document.querySelector(".actions button[aria-label='Wishlist']");
  const wishlistModal = document.getElementById("wishlistModal");
  const closeWishlist = document.getElementById("closeWishlist");
  const wishlistItems = document.getElementById("wishlistItems");

  const profileFirstName = document.getElementById("profileFirstName");
  const profileLastName = document.getElementById("profileLastName");
  const profileEmail = document.getElementById("profileEmail");
  const profileAddress = document.getElementById("profileAddress");
  const profileMobile = document.getElementById("profileMobile");

  const editProfileBtn = document.getElementById("editProfileBtn");
  const editProfileModal = document.getElementById("editProfileModal");
  const closeEditBtn = document.getElementById("closeEdit");
  const editProfileForm = document.getElementById("editProfileForm");

  const editFirstName = document.getElementById("editFirstName");
  const editLastName = document.getElementById("editLastName");
  const editAddress = document.getElementById("editAddress");
  const editMobile = document.getElementById("editMobile");

  const closeProfileBtn = document.getElementById("closeProfile");
  const profileModal = document.getElementById("profileModal");

  let USER_WISHLIST = []; // store user wishlist locally
  

  // --- Auth State ---
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const docRef = doc(db, "users", user.uid);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const data = docSnap.data();
        USER_WISHLIST = data.wishlist || [];
        const firstName = data.firstName;
        welcomeEl.textContent = firstName || "Welcome User!";
      } else {
        welcomeEl.textContent = "Welcome User!";
      }

      // render books with wishlist status
      renderBooks(BOOKS);
    } else {
      window.location.href = "login.html";
    }
  });

  document.getElementById("cartBtn").addEventListener("click", () => {
  window.location.href = "cart.html";
});

  // --- Logout ---
  logoutBtn.addEventListener("click", async () => {
    try {
      await signOut(auth);
      alert("You have logged out.");
      window.location.href = "index.html";
    } catch (error) {
      alert("Logout failed: " + error.message);
    }
  });

  // --- BOOKS DATA ---
  const BOOKS = [
    {
      title: "Hunger Games 4-Book Paperback Box Set",
      author: "Suzanne Collins",
      price: 3998,
      rating: 4,
      cover: "https://encrypted-tbn0.gstatic.com/shopping?q=tbn:ANd9GcRrwrwGqgBkR2TQPgDixUR1q1K-wp0BFDrliH1FS3cF9xuE-OUbk-E0KKgueLaalWu8ndqcoN7Nk0YwzXkzXfMW56WY1jxfkfJY9j1SmOEtkY1ASEgd1jLQtA",
    },
    {
      title: "Harry Potter and the Philosopher's Stone",
      author: "J. K. Rowling",
      price: 11931,
      rating: 5,
      cover: "https://encrypted-tbn0.gstatic.com/shopping?q=tbn:ANd9GcQqU2SF4cC-SPTQ5qVwV5BHHJMe4ygkDebAGw8jEFIwqj_fLb6hGqhw5rHgpoZnKdYUbvP9aiMPrtsbS87_ZHZCtyuyhoCN35eoh3MDfbl_wS78fcrirUCcjA",
    },
    // ... add more books
  ];

  // --- Helpers ---
  const el = (tag, cls, html) => {
    const n = document.createElement(tag);
    if (cls) n.className = cls;
    if (html !== undefined) n.innerHTML = html;
    return n;
  };

  const stars = (n) => {
    const full = "★".repeat(Math.max(0, Math.min(5, n)));
    const empty = "☆".repeat(5 - Math.max(0, Math.min(5, n)));
    return `<span class="rating">${full}${empty}</span>`;
  };

  const inWishlist = (book) => {
    return USER_WISHLIST.some((item) => item.title === book.title && item.author === book.author);
  };

  // --- Render Books ---
function renderBooks(list) {
  const grid = document.getElementById("book-grid");
  grid.innerHTML = "";

  list.forEach((b) => {
    const card = el("article", "card");

    const img = el("img", "cover");
    img.alt = `${b.title} cover`;
    img.src = b.cover;
    card.appendChild(img);

    const body = el("div", "card-body");
    body.appendChild(el("div", "title", b.title));
    body.appendChild(el("div", "byline", `by ${b.author}`));
    body.insertAdjacentHTML("beforeend", stars(b.rating));

    const priceRow = el("div", "price-row");
    priceRow.appendChild(el("div", "price", `₱${b.price.toLocaleString()}`));
    priceRow.appendChild(el("div", "pill", "In stock"));
    body.appendChild(priceRow);

    const actions = el("div", "actions-row");

    const addBtn = el("button", "btn small", "Add to Cart");
      addBtn.addEventListener("click", async () => {
        const user = auth.currentUser;
        if (!user) {
          alert("You must be logged in to add items to the cart.");
          return;
        }
      
      try {
        const docRef = doc(db, "users", user.uid);
        await updateDoc(docRef, {
          cart: arrayUnion(b), // save book to Firestore
        });
        alert(`${b.title} has been added to your cart!`);
      } catch (err) {
        console.error("Error adding to cart:", err);
        alert("Failed to add item to cart.");
      }
    });

    const heart = el("button", "btn icon secondary");
    heart.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24">
      <path d="M12.1 20.3 4.7 13c-2.6-2.6-1.9-6.9 1.6-8.5 1.7-.8 3.7-.5 5.1.7 1.4-1.2 3.4-1.5 5.1-.7 3.5 1.6 4.2 5.9 1.6 8.5l-7.3 7.3Z" 
      stroke="#7E6E5B" stroke-width="1.6" fill="${inWishlist(b) ? "#FF0000" : "#fff"}"/></svg>`;

    heart.addEventListener("click", async () => {
      const user = auth.currentUser;
      if (!user) {
        alert("You must be logged in to save wishlist.");
        return;
      }

      const docRef = doc(db, "users", user.uid);
      const path = heart.querySelector("svg path");
      const currentlyIn = inWishlist(b);

      try {
        if (currentlyIn) {
          await updateDoc(docRef, { wishlist: arrayRemove(b) });
          USER_WISHLIST = USER_WISHLIST.filter((item) => item.title !== b.title);
          path.setAttribute("fill", "#fff");
        } else {
          await updateDoc(docRef, { wishlist: arrayUnion(b) });
          USER_WISHLIST.push(b);
          path.setAttribute("fill", "#FF0000");
        }
      } catch (err) {
        console.error("Error updating wishlist:", err);
      }
    });

    actions.append(addBtn, heart);
    body.appendChild(actions);

    card.appendChild(body);
    grid.appendChild(card);
  });
}


  // --- Search ---
  const searchInput = document.getElementById("searchInput");
  searchInput.addEventListener("input", (e) => {
    const q = e.target.value.toLowerCase().trim();
    const filtered = BOOKS.filter((b) =>
      (b.title + " " + b.author).toLowerCase().includes(q)
    );
    renderBooks(filtered);
  });

  // --- Wishlist Modal ---
  wishlistBtn.addEventListener("click", async () => {
    const user = auth.currentUser;
    if (!user) {
      alert("You must be logged in.");
      return;
    }

    const docRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(docRef);

    wishlistItems.innerHTML = "";
    if (docSnap.exists() && docSnap.data().wishlist) {
      docSnap.data().wishlist.forEach((item) => {
        const div = document.createElement("div");
        div.classList.add("wishlist-item");
        div.innerHTML = `
          <img src="${item.cover}" alt="${item.title}" width="50" />
          <div>
            <strong>${item.title}</strong><br/>
            <span>by ${item.author}</span>
          </div>`;
        wishlistItems.appendChild(div);
      });
    } else {
      wishlistItems.innerHTML = "<p>No items in wishlist.</p>";
    }

    wishlistModal.style.display = "flex";
  });

  closeWishlist.addEventListener("click", () => {
    wishlistModal.style.display = "none";
  });

  // --- Profile Modal & Edit ---
  document
    .querySelector(".dropdown-content a[href='profile.html']")
    .addEventListener("click", async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (user) {
        const docRef = doc(db, "users", user.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const data = docSnap.data();
          profileFirstName.textContent = data.firstName || "Not set";
          profileLastName.textContent = data.lastName || "Not set";
          profileEmail.textContent = user.email || "No email";
          profileAddress.textContent = data.address || "Not set";
          profileMobile.textContent = data.mobile || "Not set";

          editFirstName.value = data.firstName || "";
          editLastName.value = data.lastName || "";
          editAddress.value = data.address || "";
          editMobile.value = data.mobile || "";
        }
      }
      profileModal.style.display = "flex";
    });

  closeProfileBtn.addEventListener("click", () => {
    profileModal.style.display = "none";
  });

  editProfileBtn.addEventListener("click", () => {
    profileModal.style.display = "none";
    editProfileModal.style.display = "flex";
  });

  closeEditBtn.addEventListener("click", () => {
    editProfileModal.style.display = "none";
  });

  editProfileForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const user = auth.currentUser;
    if (user) {
      const docRef = doc(db, "users", user.uid);
      await updateDoc(docRef, {
        firstName: editFirstName.value,
        lastName: editLastName.value,
        address: editAddress.value,
        mobile: editMobile.value,
      });

      alert("Profile updated successfully!");

      profileFirstName.textContent = editFirstName.value;
      profileLastName.textContent = editLastName.value;
      profileAddress.textContent = editAddress.value;
      profileMobile.textContent = editMobile.value;

      editProfileModal.style.display = "none";
      profileModal.style.display = "flex";
    }
  });

  // --- Dropdown ---
  document.querySelector(".dropdown").addEventListener("click", function (e) {
    this.classList.toggle("active");
    this.querySelector(".dropdown-content").classList.toggle("show");
    this.querySelector(".dropdown-trigger").classList.toggle("active");
    e.stopPropagation();
  });

  window.addEventListener("click", function () {
    const dropdown = document.querySelector(".dropdown");
    if (dropdown.classList.contains("active")) {
      dropdown.classList.remove("active");
      dropdown.querySelector(".dropdown-content").classList.remove("show");
      dropdown.querySelector(".dropdown-trigger").classList.remove("active");
    }
  });

  // --- Mobile Nav ---
  document.getElementById("navToggle").addEventListener("click", () => {
    const existing = document.getElementById("mobileMenu");
    if (existing) {
      existing.remove();
      return;
    }
    const menu = document.createElement("div");
    menu.id = "mobileMenu";
    menu.style.background = "var(--paper)";
    menu.style.borderTop = "1px solid var(--line)";
    menu.innerHTML = `<div class="container" style="padding:12px 20px 16px; display:grid; gap:10px;">
      <a href="homepage-logged.html">Home</a>
      <a href="#popular">Store</a>
      <a href="about-us-logged.html">About us</a>
    </div>`;
    document.querySelector(".site-header").appendChild(menu);
  });

  // --- Boot ---
  document.getElementById("yr").textContent = new Date().getFullYear();
</script>


  </body>
</html>
