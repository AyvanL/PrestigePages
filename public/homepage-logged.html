<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PestigePages â€” Premium Books</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/homepage.css" />
  
  </head>
  <body>
    <!-- Header -->
    <header class="site-header">
      <div class="container nav">
        <button
          class="icon-btn hamburger"
          id="navToggle"
          aria-label="Open menu"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M3 6h18M3 12h18M3 18h18"
              stroke="#5f5a54"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </button>
        <div class="brand">PrestigePages</div>
        <nav class="nav-links" aria-label="Main">
          <a href="homepage-logged.html">Home</a>
          <a href="#popular">Store</a>
          <a href="about-us-logged.html">About us</a>
        </nav>

        <div class="nav-spacer"></div>

        <div class="actions">
          <button class="icon-btn" aria-label="Wishlist">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12.1 20.3 4.7 13c-2.6-2.6-1.9-6.9 1.6-8.5 1.7-.8 3.7-.5 5.1.7 1.4-1.2 3.4-1.5 5.1-.7 3.5 1.6 4.2 5.9 1.6 8.5l-7.3 7.3Z"
                stroke="#7E6E5B"
                stroke-width="1.6"
                fill="#fff"
              />
            </svg>
          </button>

          <button class="icon-btn" aria-label="Cart" id="cartBtn">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M3 3h2l2.4 12.3a2 2 0 0 0 2 1.7h6.9a2 2 0 0 0 2-1.6L21 7H6"
                stroke="#7E6E5B"
                stroke-width="1.6"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <circle cx="10" cy="20" r="1.5" fill="#7E6E5B" />
              <circle cx="17" cy="20" r="1.5" fill="#7E6E5B" />
            </svg>
            <span id="cartCount" class="badge">0</span> <!-- âœ… badge -->
          </button>


          <div class="dropdown">
            <div class="dropdown-trigger">
              <button class="dropbtn" id="welcomeMessage">Loading....</button>
              <img
                src="images/down-arrow.png"
                alt="arrow"
                width="30"
                class="dropdown-arrow"
              />
            </div>
            <div class="dropdown-content">
              <a href="profile.html">Profile</a>
              <a href="#" id="logoutBtn">Logout</a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main>
      <!-- Hero -->
      <section class="hero">
        <div class="container hero-inner">
          <div class="hero-copy">
            <div class="eyebrow">New Arrivals</div>
            <h1>Experience our<br />New Exclusive Books</h1>
            <p>
              Discover handâ€‘picked titles from acclaimed authors. Enjoy quality
              hardbacks, digital editions, and secure shipping right to your
              door.
            </p>
            <div class="cta">
              <a href="#popular" class="btn">Shop Now</a>
              <a href="#about" class="btn secondary">Learn more</a>
            </div>
          </div>
          <div class="hero-art">
            <div class="stack">
              <img
                alt="Book stack"
                src="https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?q=80&w=700&auto=format&fit=crop"
              />
            </div>
            <div class="blob" aria-hidden="true"></div>
          </div>
        </div>
      </section>

      <!-- Feature bar -->
      <section class="features">
        <div class="container feature-row">
          <div class="feature">
            <div class="badge" aria-hidden>
              <svg
                width="22"
                height="22"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 2 3 6v6c0 5 3.8 9.7 9 10 5.2-.3 9-5 9-10V6l-9-4Z"
                  fill="#F6E8C8"
                  stroke="#C89B3C"
                />
                <path
                  d="m8.5 12 2.3 2.3 4.7-4.7"
                  fill="none"
                  stroke="#3F7A3B"
                  stroke-width="2"
                  stroke-linecap="round"
                />
              </svg>
            </div>
            <div>
              <h4>Certified</h4>
              <p>Authentic editions from the publisher</p>
            </div>
          </div>
          <div class="feature">
            <div class="badge" aria-hidden>
              <svg
                width="22"
                height="22"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <rect
                  x="3"
                  y="8"
                  width="18"
                  height="12"
                  rx="2"
                  fill="#F6E8C8"
                  stroke="#C89B3C"
                />
                <path
                  d="M7 8V6a5 5 0 0 1 10 0v2"
                  stroke="#7E6E5B"
                  stroke-width="2"
                  fill="none"
                />
              </svg>
            </div>
            <div>
              <h4>Secure</h4>
              <p>Encrypted checkout and privacyâ€‘first</p>
            </div>
          </div>
          <div class="feature">
            <div class="badge" aria-hidden>
              <svg
                width="22"
                height="22"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M3 14h16l2 4H5l-2-4Z"
                  fill="#F6E8C8"
                  stroke="#C89B3C"
                />
                <path d="M7 14V9h12l2 5" fill="none" stroke="#7E6E5B" />
                <circle cx="8" cy="19" r="1.6" fill="#7E6E5B" />
                <circle cx="18" cy="19" r="1.6" fill="#7E6E5B" />
              </svg>
            </div>
            <div>
              <h4>Shipping</h4>
              <p>Fast, reliable worldwide delivery</p>
            </div>
          </div>
        </div>
      </section>

     
    <!-- Popular books -->
    <section id="popular" class="container popular-section">
      <div class="popular-header">
        <h2>Our Popular Books</h2>

        <!-- Search Input -->
        <div class="search" role="search">
          <input id="searchInput" type="search" placeholder="Search booksâ€¦" />  
          <svg
            aria-hidden
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="11" cy="11" r="7" stroke="#A89983" stroke-width="2" />
            <path
              d="m20 20-3.5-3.5"
              stroke="#A89983"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </div>
      </div>

      <div class="content-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
          <h3>Categories</h3>
            <label><input type="radio" name="category" value="all" checked> See All</label><br>
            <label><input type="radio" name="category" value="romance"> Romance</label><br>
            <label><input type="radio" name="category" value="mystery"> Mystery</label><br>
            <label><input type="radio" name="category" value="science"> Science</label><br>
            <label><input type="radio" name="category" value="non-fiction"> Non-Fiction</label><br>
            <label><input type="radio" name="category" value="children"> Children's Books</label><br>
            <label><input type="radio" name="category" value="classics"> Classics</label><br>
            <label><input type="radio" name="category" value="comics"> Comics</label><br>
            <label><input type="radio" name="category" value="business"> Business</label>
          <hr />
          <h3>Price Range</h3>
            <div class="price-range">
              <label for="minPrice">Min: â‚±<span id="minPriceVal">0</span></label>
              <input type="range" id="minPrice" min="0" max="2000" step="50" value="0">

              <label for="maxPrice">Max: â‚±<span id="maxPriceVal">2000</span></label>
              <input type="range" id="maxPrice" min="0" max="2000" step="50" value="2000">
            </div>
        </aside>

        <!-- Main content -->
        <div class="main-content">
          <!-- Books grid -->
          <div id="book-grid" class="grid" aria-live="polite"></div>
        </div>
      </div>
    </section>
    </main>

    <footer style="border-color: #222222">
      <div class="container">
        <div style="display: flex; gap: 14px; align-items: center">
          <div class="brand">PrestigePages.com</div>
          <span>Â© <span id="yr"></span> â€¢ All rights reserved</span>
        </div>
      </div>
    </footer>

   <!-- Profile Modal -->
    <div id="profileModal" class="modal">
      <div class="modal-content">
        <span id="closeProfile" class="close-btn">&times;</span>

        <h2>Your Profile</h2>

        <p>
          <strong>First Name:</strong>
          <span id="profileFirstName">Loading...</span>
        </p>
        <p>
          <strong>Last Name:</strong>
          <span id="profileLastName">Loading...</span>
        </p>
        <p><strong>Email:</strong> <span id="profileEmail">Loading...</span></p>
        <p>
          <strong>Address:</strong> <span id="profileAddress">Not set</span>
        </p>
        <p><strong>Mobile:</strong> <span id="profileMobile">Not set</span></p>

        <button id="editProfileBtn" class="btn">Edit Profile</button>
      </div>
    </div>


    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" id="closeEdit">&times;</span>
        <h2>Edit Profile</h2>

        <form id="editProfileForm">
          <label>First Name</label>
          <input type="text" id="editFirstName" required />

          <label>Last Name</label>
          <input type="text" id="editLastName" required />

          <label>Address</label>
          <input type="text" id="editAddress" />

          <label>Mobile Number</label>
          <input type="text" id="editMobile" />

          <button type="submit" class="btn">Save Changes</button>
        </form>
      </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
      <div class="modal-content">
        <span id="closeCart" class="close-btn">&times;</span>
        <h2>Your Cart ðŸ›’</h2>

        <!-- Scrollable container -->
        <div class="cart-items-wrapper">
          <ul id="cartItems"></ul>
        </div>

        <div id="cartTotal"></div>
        <button id="checkoutBtn">Proceed to Checkout</button>
      </div>
    </div>

    <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    signOut,
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import {
    getFirestore,
    doc,
    getDoc,
    updateDoc,
    setDoc,
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCC_14beDBhudrtoAIFqc29TCMY5zoa4AA",
    authDomain: "prestige-pages.firebaseapp.com",
    databaseURL: "https://prestige-pages-default-rtdb.firebaseio.com",
    projectId: "prestige-pages",
    storageBucket: "prestige-pages.appspot.com",
    messagingSenderId: "1065922943021",
    appId: "1:1065922943021:web:e5829dd09e206063b500a4",
    measurementId: "G-V0E6PXN1Z5",
  };

  // Init Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Elements
  const profileFirstName = document.getElementById("profileFirstName");
  const profileLastName = document.getElementById("profileLastName");
  const profileEmail = document.getElementById("profileEmail");
  const profileAddress = document.getElementById("profileAddress");
  const profileMobile = document.getElementById("profileMobile");

  const editProfileBtn = document.getElementById("editProfileBtn");
  const editProfileModal = document.getElementById("editProfileModal");
  const closeEditBtn = document.getElementById("closeEdit");
  const editProfileForm = document.getElementById("editProfileForm");

  const editFirstName = document.getElementById("editFirstName");
  const editLastName = document.getElementById("editLastName");
  const editAddress = document.getElementById("editAddress");
  const editMobile = document.getElementById("editMobile");

  const closeProfileBtn = document.getElementById("closeProfile");

  const welcomeEl = document.getElementById("welcomeMessage");
  const logoutBtn = document.getElementById("logoutBtn");

  // Cart system variables
  let cart = [];

  const cartBtn = document.getElementById("cartBtn");
  const cartCount = document.getElementById("cartCount");
  const cartModal = document.getElementById("cartModal");
  const closeCart = document.getElementById("closeCart");
  const cartItemsEl = document.getElementById("cartItems");
  const cartTotalEl = document.getElementById("cartTotal");

  // --- Helper functions for Firestore cart ---

  // Save cart to Firestore for current user
  async function saveCartToFirestore() {
    const user = auth.currentUser  ;
    if (!user) return;

    const userDocRef = doc(db, "users", user.uid);
    try {
      await updateDoc(userDocRef, { cart });
    } catch (error) {
      // If cart field doesn't exist yet, create it
      await setDoc(userDocRef, { cart }, { merge: true });
    }
  }

  // Load cart from Firestore for current user
  async function loadCartFromFirestore() {
    const user = auth.currentUser  ;
    if (!user) return;

    const userDocRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(userDocRef);
    if (docSnap.exists()) {
      const data = docSnap.data();
      if (data.cart && Array.isArray(data.cart)) {
        cart = data.cart;
        await updateCart();
      }
    }
  }

  // --- Profile modal and edit profile logic ---

  // When Profile is clicked, load data
  document
    .querySelector(".dropdown-content a[href='profile.html']")
    .addEventListener("click", async (e) => {
      e.preventDefault();

      const user = auth.currentUser  ;
      if (user) {
        const docRef = doc(db, "users", user.uid);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();
          profileFirstName.textContent = data.firstName || "Not set";
          profileLastName.textContent = data.lastName || "Not set";
          profileEmail.textContent = user.email || "No email";
          profileAddress.textContent = data.address || "Not set";
          profileMobile.textContent = data.mobile || "Not set";

          // Prefill edit form
          editFirstName.value = data.firstName || "";
          editLastName.value = data.lastName || "";
          editAddress.value = data.address || "";
          editMobile.value = data.mobile || "";
        }
      }

      profileModal.style.display = "flex";
    });

  closeProfileBtn.addEventListener("click", () => {
    profileModal.style.display = "none";
  });

  // Open Edit Profile Modal
  editProfileBtn.addEventListener("click", () => {
    profileModal.style.display = "none";
    editProfileModal.style.display = "flex";
  });

  // Close Edit Modal
  closeEditBtn.addEventListener("click", () => {
    editProfileModal.style.display = "none";
  });

  // Handle form submit
  editProfileForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const user = auth.currentUser  ;
    if (user) {
      const docRef = doc(db, "users", user.uid);

      await updateDoc(docRef, {
        firstName: editFirstName.value,
        lastName: editLastName.value,
        address: editAddress.value,
        mobile: editMobile.value,
      });

      alert("Profile updated successfully!");

      // Refresh display
      profileFirstName.textContent = editFirstName.value;
      profileLastName.textContent = editLastName.value;
      profileAddress.textContent = editAddress.value;
      profileMobile.textContent = editMobile.value;

      editProfileModal.style.display = "none";
      profileModal.style.display = "flex";
    }
  });

  // Dropdown toggle
  document.querySelector(".dropdown").addEventListener("click", function (e) {
    this.classList.toggle("active");
    this.querySelector(".dropdown-content").classList.toggle("show");
    this.querySelector(".dropdown-trigger").classList.toggle("active");
    e.stopPropagation();
  });

  // Close dropdown when clicking outside
  window.addEventListener("click", function () {
    const dropdown = document.querySelector(".dropdown");
    if (dropdown.classList.contains("active")) {
      dropdown.classList.remove("active");
      dropdown.querySelector(".dropdown-content").classList.remove("show");
      dropdown.querySelector(".dropdown-trigger").classList.remove("active");
    }
  });

  // Check if user is logged in
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      // Get extra data from Firestore
      const docRef = doc(db, "users", user.uid);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const firstName = docSnap.data().firstName;
        welcomeEl.textContent = firstName;
      } else {
        welcomeEl.textContent = "Welcome User!";
      }

      // Load cart from Firestore
      await loadCartFromFirestore();
    } else {
      // Not logged in â†’ redirect to login
      window.location.href = "login.html";
    }
  });

  // Handle logout
  logoutBtn.addEventListener("click", async () => {
    try {
      await signOut(auth);
      alert("You have logged out.");
      window.location.href = "index.html";
    } catch (error) {
      alert("Logout failed: " + error.message);
    }
  });

  // --- Demo data -------------------------------------------------------
  const BOOKS = [
    {
      title: "For the Record",
      author: "Emma Lord",
      price: 1025.99,
      rating: 4,
      category: "romance",
      cover:
        "https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1726945848i/217387723.jpg",
    },
    {
      title: "High Seasons",
      author: "Katie Bishop",
      price: 1709.94,
      rating: 3.83,
      category: "mystery",
      cover:
        "https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1728226919i/217388179.jpg",
    },
    {
      title:
        "We Are Eating the Earth: The Race to Fix Our Food System and Save Our Climate",
      author: "Michael Grunwarld",
      price: 1708.17,
      rating: 4.26,
      category: "science",
      cover:
        "https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1732454271i/220595471.jpg",
    },
    {
      title: "Hotshot: A Life on Fire",
      author: "River Selby",
      price: 1200,
      rating: 3.81,
      category: "non-fiction",
      cover:
        "https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1739100108i/219301091.jpg",
    },
    {
      title: "Ghost Circus",
      author: "Adrienne Kress, Jade Zhang",
      price: 799,
      rating: 4,
      category: "children",
      cover:
        "https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1740594745i/218681305.jpg",
    },
    {
      title: "The Fellowship of the Ring",
      author: "J.R.R. Tolkien",
      price: 799,
      rating: 4,
      category: "classics",
      cover:
        "https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1654215925i/61215351.jpg",
    },
    {
      title: "Psylocke Vol. 1: Guardian",
      author: "Alyssa Wong",
      price: 799,
      rating: 3.52,
      category: "comics",
      cover:
        "https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1728445659i/220240990.jpg",
    },
    {
      title: "Abundance",
      author: "Ezra Klein, Derek Thompson",
      price: 799,
      rating: 4.02,
      category: "business",
      cover:
        "https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1737312514i/176444106.jpg",
    },
  ];

  // --- Render helpers --------------------------------------------------
  const el = (tag, cls, html) => {
    const n = document.createElement(tag);
    if (cls) n.className = cls;
    if (html !== undefined) n.innerHTML = html;
    return n;
  };

  const stars = (n) => {
    const full = "â˜…".repeat(Math.max(0, Math.min(5, n)));
    const empty = "â˜†".repeat(5 - Math.max(0, Math.min(5, n)));
    return `<span class="rating" aria-label="${n} out of 5 stars">${full}${empty}</span>`;
  };

  function renderBooks(list) {
    const grid = document.getElementById("book-grid");
    grid.innerHTML = "";

    list.forEach((b) => {
      const card = el("article", "card");

      const img = el("img", "cover");
      img.alt = `${b.title} cover`;
      img.src = b.cover;
      card.appendChild(img);

      const body = el("div", "card-body");
      body.appendChild(el("div", "title", b.title));
      body.appendChild(el("div", "byline", `by ${b.author}`));
      body.insertAdjacentHTML("beforeend", stars(b.rating));

      const priceRow = el("div", "price-row");
      priceRow.appendChild(
        el(
          "div",
          "price",
          `â‚±${b.price.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          })}`
        )
      );
      priceRow.appendChild(el("div", "pill", "In stock"));
      body.appendChild(priceRow);

      const actions = el("div", "actions-row");

      const addBtn = el("button", "btn small");
      addBtn.textContent = "Add to Cart";
      addBtn.addEventListener("click", async () => {
        const existing = cart.find((c) => c.title === b.title);
        if (existing) {
          existing.qty++;
        } else {
          cart.push({ ...b, qty: 1 });
        }
        await saveCartToFirestore();
        await updateCart();
        alert(`Added "${b.title}" to cart.`);
      });

      const heart = el("button", "btn icon secondary");
      heart.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M12.1 20.3 4.7 13c-2.6-2.6-1.9-6.9 1.6-8.5 1.7-.8 3.7-.5 5.1.7 1.4-1.2 3.4-1.5 5.1-.7 3.5 1.6 4.2 5.9 1.6 8.5l-7.3 7.3Z" stroke="#7E6E5B" stroke-width="1.6" fill="#fff"/>
        </svg>`;

      heart.addEventListener("click", () => {
        const path = heart.querySelector("svg path");
        const isActive = heart.classList.toggle("active");
        path.setAttribute("fill", isActive ? "#FF0000" : "#fff");
      });

      actions.append(addBtn, heart);
      body.appendChild(actions);

      card.appendChild(body);
      grid.appendChild(card);
    });
  }

  // search filtering
  const searchInput = document.getElementById("searchInput");
  searchInput.addEventListener("input", (e) => {
    const q = e.target.value.toLowerCase().trim();
    const filtered = BOOKS.filter((b) =>
      (b.title + " " + b.author).toLowerCase().includes(q)
    );
    renderBooks(filtered);
  });

  window.handleLogout = async function () {
    try {
      await signOut(auth);
      alert("You have logged out.");
      window.location.href = "index.html";
    } catch (error) {
      alert("Logout failed: " + error.message);
    }
  };

  // mobile nav demo (expand inline links under header)
  document.getElementById("navToggle").addEventListener("click", () => {
    const existing = document.getElementById("mobileMenu");
    if (existing) {
      existing.remove();
      return;
    }
    const menu = document.createElement("div");
    menu.id = "mobileMenu";
    menu.style.background = "var(--paper)";
    menu.style.borderTop = "1px solid var(--line)";
    menu.innerHTML = `<div class="container" style="padding:12px 20px 16px; display:grid; gap:10px;">
        <a href="homepage-logged.html">Home</a>
        <a href="#popular">Store</a>
        <a href="about-us-logged.html">About us</a>
      </div>`;
    document.querySelector(".site-header").appendChild(menu);
  });

  // boot
  document.getElementById("yr").textContent = new Date().getFullYear();
  renderBooks(BOOKS);

  // --- category filtering ---
  document.querySelectorAll('input[name="category"]').forEach((radio) => {
    radio.addEventListener("change", (e) => {
      const selected = e.target.value;
      if (selected === "all") {
        renderBooks(BOOKS); // show everything
      } else {
        const filtered = BOOKS.filter((b) => b.category === selected);
        renderBooks(filtered);
      }
    });
  });

  // --- price range slider ---
  const minPrice = document.getElementById("minPrice");
  const maxPrice = document.getElementById("maxPrice");
  const minPriceVal = document.getElementById("minPriceVal");
  const maxPriceVal = document.getElementById("maxPriceVal");

  // update displayed values when sliders move
  [minPrice, maxPrice].forEach((slider) => {
    slider.addEventListener("input", () => {
      minPriceVal.textContent = minPrice.value;
      maxPriceVal.textContent = maxPrice.value;
      applyFilters();
    });
  });

  // --- update your applyFilters() ---
  function applyFilters() {
    const selectedCategory = document.querySelector(
      'input[name="category"]:checked'
    ).value;
    const searchTerm = document.getElementById("searchInput").value.toLowerCase();
    const min = parseInt(minPrice.value);
    const max = parseInt(maxPrice.value);

    let filtered = BOOKS;

    // filter by category
    if (selectedCategory !== "all") {
      filtered = filtered.filter((b) => b.category === selectedCategory);
    }

    // filter by price range
    filtered = filtered.filter((b) => b.price >= min && b.price <= max);

    // filter by search keyword
    if (searchTerm) {
      filtered = filtered.filter(
        (b) =>
          b.title.toLowerCase().includes(searchTerm) ||
          b.author.toLowerCase().includes(searchTerm)
      );
    }

    renderBooks(filtered);
  }
    // --- Cart system ---

  async function updateCart() {
    cartItemsEl.innerHTML = "";
    let total = 0;

    cart.forEach((item, i) => {
      total += item.price * item.qty;

      const div = document.createElement("div");
      div.classList.add("cart-item");

      div.innerHTML = `
            <img src="${item.cover}" alt="${item.title}">
            <div class="cart-item-details">
                            <h4>${item.title}</h4>
              <p>${item.author || "No Brand"}</p>
            </div>
            <div class="cart-item-price">â‚±${item.price.toFixed(2)}</div>
            <div class="cart-qty">
              <button class="decrease">-</button>
              <input type="text" value="${item.qty}" readonly>
              <button class="increase">+</button>
            </div>
            <span class="cart-remove">ðŸ—‘</span>
          `;

      div.querySelector(".cart-remove").addEventListener("click", async () => {
        cart.splice(i, 1);
        await updateCart();
        await saveCartToFirestore();
      });

      div.querySelector(".decrease").addEventListener("click", async () => {
        if (item.qty > 1) {
          item.qty--;
          await updateCart();
          await saveCartToFirestore();
        }
      });

      div.querySelector(".increase").addEventListener("click", async () => {
        item.qty++;
        await updateCart();
        await saveCartToFirestore();
      });

      cartItemsEl.appendChild(div);
    });

    cartTotalEl.textContent = `Total: â‚±${total.toFixed(2)}`;
    cartCount.textContent = cart.length;
  }

  // Show/hide cart modal
  cartBtn.addEventListener("click", async () => {
    await loadCartFromFirestore();
    cartModal.style.display = "flex";
  });

  closeCart.addEventListener("click", () => {
    cartModal.style.display = "none";
  });

  // Close modal when clicking outside
  window.addEventListener("click", (e) => {
    if (e.target === cartModal) {
      cartModal.style.display = "none";
    }
  });
</script>

  </body>
</html>